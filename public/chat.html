<section id="settings">
  <h2>Settings</h2>
  <p>Manage your account below.</p>

  <!-- Profile Picture -->
  <h3>Profile Picture</h3>
  <img id="profilePicPreview" src="" alt="No Profile Picture" style="width:100px; height:100px; object-fit:cover; border-radius:50%; border:1px solid #ccc; display:block; margin-bottom:10px;">
  <input type="file" id="profilePicInput" accept="image/*"><br><br>
  <button onclick="saveProfilePic()">Save Profile Picture</button>

  <hr>

  <!-- Change Password -->
  <!-- ... keep your existing change password inputs and button here ... -->

  <hr>

  <!-- Change Username -->
  <!-- ... keep your existing change username inputs and button here ... -->

  <hr style="margin: 1.5rem 0;">

  <!-- Log Out -->
  <button onclick="logout()" style="padding:10px 20px; font-size:1.1rem; background:red; color:white; border:none; border-radius:6px; cursor:pointer;">Log Out</button>
</section>

<script>
  const currentUser = params.get('user') || 'Anonymous';
  const storageKey = 'chatAppUsers';
  const picKey = 'chatAppProfilePics';

  // Load profile picture on settings open
  window.addEventListener('load', () => {
    loadProfilePic();
  });

  function getProfilePics() {
    return JSON.parse(localStorage.getItem(picKey)) || {};
  }
  function saveProfilePics(pics) {
    localStorage.setItem(picKey, JSON.stringify(pics));
  }

  function loadProfilePic() {
    const pics = getProfilePics();
    const picData = pics[currentUser];
    const img = document.getElementById('profilePicPreview');
    if (picData) {
      img.src = picData;
    } else {
      img.src = '';
      img.alt = "No Profile Picture";
    }
  }

  function saveProfilePic() {
    const input = document.getElementById('profilePicInput');
    if (!input.files || !input.files[0]) {
      alert("Please select an image first.");
      return;
    }
    const file = input.files[0];
    if (!file.type.startsWith('image/')) {
      alert("Only image files are allowed.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      let pics = getProfilePics();
      pics[currentUser] = e.target.result;  // Base64 image string
      saveProfilePics(pics);
      alert("Profile picture saved!");
      loadProfilePic();
    };
    reader.readAsDataURL(file);
  }

  // (Keep your existing password & username change functions here...)

  function logout() {
    window.location.href = 'index.html';
  }
</script>