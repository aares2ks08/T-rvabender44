<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat & Pictures App</title>
<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #menu {
    display: flex;
    justify-content: center;
    background: #1f1f1f;
  }
  #menu button {
    flex: 1;
    padding: 15px 0;
    background: #1f1f1f;
    color: #eee;
    border: none;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s;
  }
  #menu button.active, #menu button:hover {
    background: #6200ee;
    color: white;
  }
  section {
    flex-grow: 1;
    display: none;
    padding: 20px;
    overflow-y: auto;
  }
  section.active {
    display: block;
  }
  #chat #messages {
    height: 300px;
    background: #222;
    border-radius: 6px;
    padding: 10px;
    overflow-y: auto;
    margin-bottom: 10px;
  }
  #chat #messages div {
    margin-bottom: 8px;
    word-wrap: break-word;
  }
  #chat form {
    display: flex;
  }
  #chat input[type=text] {
    flex-grow: 1;
    padding: 10px;
    border-radius: 6px 0 0 6px;
    border: none;
    font-size: 1rem;
  }
  #chat button {
    padding: 10px 20px;
    background: #6200ee;
    border: none;
    color: white;
    border-radius: 0 6px 6px 0;
    cursor: pointer;
    font-weight: bold;
  }
  #pictures #uploadedImages img {
    max-width: 100%;
    max-height: 200px;
    margin: 10px 0;
    border-radius: 6px;
  }
  #settings label {
    display: block;
    margin-bottom: 8px;
  }
  #settings input[type=file] {
    color: #eee;
  }
</style>
</head>
<body>

<div id="menu">
  <button class="active" data-section="chat">Chat</button>
  <button data-section="pictures">Pictures</button>
  <button data-section="settings">Settings</button>
</div>

<section id="chat" class="active">
  <h2>Chat Room</h2>
  <div id="messages"></div>
  <form id="chatForm">
    <input id="chatInput" type="text" autocomplete="off" placeholder="Type a message..." />
    <button type="submit">Send</button>
  </form>
</section>

<section id="pictures">
  <h2>Picture Posting</h2>
  <input type="file" id="pictureInput" accept="image/*" />
  <button id="uploadBtn">Upload Picture</button>
  <div id="uploadedImages"></div>
</section>

<section id="settings">
  <h2>Settings</h2>
  <label for="profilePicInput">Upload Profile Picture:</label>
  <input type="file" id="profilePicInput" accept="image/*" />
  <div id="profilePicPreview" style="margin-top:10px;"></div>
</section>

<script src="/socket.io/socket.io.js"></script>
<script>
  // Menu switching
  const buttons = document.querySelectorAll('#menu button');
  const sections = document.querySelectorAll('section');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      sections.forEach(s => s.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.section).classList.add('active');
    });
  });

  // Chat logic
  const socket = io();
  const messagesDiv = document.getElementById('messages');
  const chatForm = document.getElementById('chatForm');
  const chatInput = document.getElementById('chatInput');

  chatForm.addEventListener('submit', e => {
    e.preventDefault();
    const text = chatInput.value.trim();
    if (!text) return;
    socket.emit('chat message', { user: 'Anonymous', text });
    chatInput.value = '';
  });

  socket.on('chat message', msg => {
    const div = document.createElement('div');
    div.textContent = `${msg.user}: ${msg.text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });

  // Picture upload
  const pictureInput = document.getElementById('pictureInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const uploadedImages = document.getElementById('uploadedImages');

  uploadBtn.addEventListener('click', () => {
    if (!pictureInput.files.length) return alert('Select a picture first');
    const file = pictureInput.files[0];
    const formData = new FormData();
    formData.append('picture', file);

    fetch('/upload', {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      const img = document.createElement('img');
      img.src = data.url;
      uploadedImages.prepend(img);
      pictureInput.value = '';
    })
    .catch(() => alert('Upload failed'));
  });

  // Settings - profile pic preview
  const profilePicInput = document.getElementById('profilePicInput');
  const profilePicPreview = document.getElementById('profilePicPreview');

  profilePicInput.addEventListener('change', () => {
    if (!profilePicInput.files.length) return;
    const file = profilePicInput.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      profilePicPreview.innerHTML = `<img src="${reader.result}" alt="Profile Picture" style="max-width:150px; border-radius:50%;">`;
    };
    reader.readAsDataURL(file);
  });
</script>

</body>
</html>